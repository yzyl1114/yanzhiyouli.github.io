import{exams}from"./exams.js";const moment=window.moment;function updateCurrentDate(){const now=moment().tz("Asia/Shanghai");const weekdays=["日","一","二","三","四","五","六"];const dateStr=`${now.year()}年${now.month()+1}月${now.date()}日，星期${weekdays[now.day()]}`;document.getElementById("current-date").textContent=dateStr}function sortExamsByProximity(exams){const now=moment().tz("Asia/Shanghai");return exams.slice().sort(((a,b)=>{const diffA=moment(a.date).diff(now);const diffB=moment(b.date).diff(now);return diffA-diffB}))}function renderCountdownEntries(){const entryGrid=document.querySelector(".entry-grid");entryGrid.innerHTML="";const sortedExams=sortExamsByProximity(exams);sortedExams.forEach((exam=>{const now=moment().tz("Asia/Shanghai");const examTime=moment(exam.date);const diff=examTime.diff(now);const entryItem=document.createElement("div");entryItem.className="entry-item";if(diff<=0){entryItem.classList.add("entry-ended");entryItem.innerHTML=`\n                <div class="overlay"></div>\n                <div class="ended-badge">已结束</div>\n                <img src="${exam.image}" alt="${exam.name}" class="entry-image">\n                <h3 class="entry-title">${exam.name}</h3>\n            `}else{entryItem.innerHTML=`\n                <img src="${exam.image}" alt="${exam.name}" class="entry-image">\n                <h3 class="entry-title">${exam.name}</h3>\n            `}entryItem.addEventListener("click",(()=>{window.location.href=`countdown.html?id=${exam.id}`}));entryGrid.appendChild(entryItem)}))}function showActivityModal(){const activityModal=document.getElementById("activity-modal");if(Math.random()>.3&&!localStorage.getItem("activityModalShown")){activityModal.style.display="flex";localStorage.setItem("activityModalShown","true")}}function initHomePage(){if(typeof moment==="undefined"||typeof moment.tz==="undefined"){console.error("Moment.js 或 Moment-Timezone 未正确加载");return}updateCurrentDate();renderCountdownEntries();showActivityModal();document.querySelectorAll(".close-modal").forEach((closeBtn=>{closeBtn.addEventListener("click",(()=>{document.querySelectorAll(".modal").forEach((modal=>{modal.style.display="none"}))}))}));window.addEventListener("click",(e=>{document.querySelectorAll(".modal").forEach((modal=>{if(e.target===modal){modal.style.display="none"}}))}))}document.addEventListener("DOMContentLoaded",initHomePage);setInterval(updateCurrentDate,6e4);if(top!==self){top.location=self.location}